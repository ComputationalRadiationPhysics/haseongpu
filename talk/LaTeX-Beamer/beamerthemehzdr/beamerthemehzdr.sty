%
% Beamer LaTeX class theme according to HZDR corporate design
%
% (C) 2011 Alexander Grahn, HZDR, Institut fuer Sicherheitsforschung
%
% Version 20131122
%

\usetheme{default}
\usepackage{tikz}
\usetikzlibrary{calc}
\usepackage{calc}
\usepackage{bookmark}
\usepackage[font=Helv,timeinterval=60]{tdclocknew}
\useinnertheme{rectangles}
\graphicspath{{beamerthemehzdr/logos/ddconcept/}%
{beamerthemehzdr/logos/gesamtlogo/}%
{beamerthemehzdr/logos/hzdr/}%
}

%font settings
\usefonttheme{professionalfonts} %don't let beamer meddle with the math fonts
\usepackage[T1]{fontenc}

\ifdefined\arial
    \usepackage[scaled=0.95]{uarial}
    \def\replacemath{}
\fi

\ifdefined\helvetica
    \usepackage[scaled=0.95]{helvet}
    \def\replacemath{}
\fi

\ifdefined\replacemath
  %following lines borrowed from cmbright.sty (for math font)
  \DeclareSymbolFont      {operators} {OT1}{cmbr}{m}{n}
  \DeclareSymbolFont        {letters} {OML}{cmbrm}{m}{it}
  \SetSymbolFont      {letters}{bold} {OML}{cmbrm}{b}{it}
  \DeclareSymbolFont        {symbols} {OMS}{cmbrs}{m}{n}
  \DeclareMathAlphabet{\mathit} {OT1}{cmbr}{m}{sl}
  \DeclareMathAlphabet{\mathbf} {OT1}{cmbr}{bx}{n}
  \DeclareMathAlphabet{\mathtt} {OT1}{cmtl}{m}{n}
  \DeclareMathAlphabet{\mathbold}{OML}{cmbrm}{b}{it}
  \DeclareMathSymbol{\alpha}{\mathalpha}{letters}{11}
  \DeclareMathSymbol{\beta}{\mathalpha}{letters}{12}
  \DeclareMathSymbol{\gamma}{\mathalpha}{letters}{13}
  \DeclareMathSymbol{\delta}{\mathalpha}{letters}{14}
  \DeclareMathSymbol{\epsilon}{\mathalpha}{letters}{15}
  \DeclareMathSymbol{\zeta}{\mathalpha}{letters}{16}
  \DeclareMathSymbol{\eta}{\mathalpha}{letters}{17}
  \DeclareMathSymbol{\theta}{\mathalpha}{letters}{18}
  \DeclareMathSymbol{\iota}{\mathalpha}{letters}{19}
  \DeclareMathSymbol{\kappa}{\mathalpha}{letters}{20}
  \DeclareMathSymbol{\lambda}{\mathalpha}{letters}{21}
  \DeclareMathSymbol{\mu}{\mathalpha}{letters}{22}
  \DeclareMathSymbol{\nu}{\mathalpha}{letters}{23}
  \DeclareMathSymbol{\xi}{\mathalpha}{letters}{24}
  \DeclareMathSymbol{\pi}{\mathalpha}{letters}{25}
  \DeclareMathSymbol{\rho}{\mathalpha}{letters}{26}
  \DeclareMathSymbol{\sigma}{\mathalpha}{letters}{27}
  \DeclareMathSymbol{\tau}{\mathalpha}{letters}{28}
  \DeclareMathSymbol{\upsilon}{\mathalpha}{letters}{29}
  \DeclareMathSymbol{\phi}{\mathalpha}{letters}{30}
  \DeclareMathSymbol{\chi}{\mathalpha}{letters}{31}
  \DeclareMathSymbol{\psi}{\mathalpha}{letters}{32}
  \DeclareMathSymbol{\omega}{\mathalpha}{letters}{33}
  \DeclareMathSymbol{\varepsilon}{\mathalpha}{letters}{34}
  \DeclareMathSymbol{\vartheta}{\mathalpha}{letters}{35}
  \DeclareMathSymbol{\varpi}{\mathalpha}{letters}{36}
  \DeclareMathSymbol{\varrho}{\mathalpha}{letters}{37}
  \DeclareMathSymbol{\varsigma}{\mathalpha}{letters}{38}
  \DeclareMathSymbol{\varphi}{\mathalpha}{letters}{39}
  \let\upDelta\Delta
  \let\upOmega\Omega
  \let\upGamma\Gamma
  \let\upTheta\Theta
  \let\upLambda\Lambda
  \let\upXi\Xi
  \let\upPi\Pi
  \let\upSigma\Sigma
  \let\upUpsilon\Upsilon
  \let\upPhi\Phi
  \let\upPsi\Psi
\else
  \usepackage{cmbright} %nice sans serif font, comes with appropriate math font
\fi

%hzdr/helmholtz colours:
\definecolor{hzdr-blue}    {rgb}{0,0.345098039216,0.611764705882}
\definecolor{hzdr-orange}  {rgb}{0.811764705882,0.407843137255,0}
\definecolor{hzdr-darkblue}{rgb}{0,0.243137254902,0.43137254902}
\definecolor{hzdr-gray1}   {gray}{0.317647058824}
\definecolor{hzdr-gray2}   {gray}{0.611764705882}
\definecolor{hzdr-gray3}   {gray}{0.725490196078}
\definecolor{hzdr-health}  {rgb}{0.83137254902,0.176470588235,0.0705882352941}
\definecolor{hzdr-struct}  {rgb}{0.811764705882,0.407843137255,0}
\definecolor{hzdr-energy}  {rgb}{0.901960784314,0.686274509804,0.0666666666667}
\definecolor{hzdr-earth}   {rgb}{0.078431372549,0.301960784314,0.156862745098}
\definecolor{hzdr-keytec}  {rgb}{0.662745098039,0.709803921569,0.0352941176471}
\definecolor{hzdr-aero}    {rgb}{0,0.635294117647,0.878431372549}

\setbeamercolor{structure}{fg=hzdr-blue}
\setbeamercolor{structure1}{fg=hzdr-blue}
\setbeamercolor{structure2}{fg=hzdr-blue}
\def\beamernavigationcolorlight{hzdr-blue!50!white}

%navigation buttons
\pgfdefobject{beamerfullscreen}{\pgfpoint{0pt}{-1pt}}{\pgfpoint{20pt}{5pt}}
{\pgfpathrectangle{\pgfpoint{7.5pt}{0pt}}{\pgfpoint{5pt}{4pt}}%
\pgfpathrectangle{\pgfpoint{8.5pt}{1pt}}{\pgfpoint{3pt}{2pt}}%
\pgfusepathqstroke%
}

\def\insertfullscreensymbol{%
  \begin{pgfpicture}{0pt}{-1.5pt}{20pt}{5.5pt}
    \pgfuseobject{beamerfullscreen}%
  \end{pgfpicture}\kern-20pt%
  \hspace{5pt}%
  \Acrobatmenu{FullScreen}{\beamer@linkspace{10pt}}%
  \hspace{5pt}%
}

\def\insertframenavigationsymbol{%
  \begin{pgfpicture}{0pt}{-1.5pt}{20pt}{5.5pt}
    \pgfuseobject{beamerframenavlight}%
    \pgfuseobject{beamerslidenavstrong}%
  \end{pgfpicture}\kern-20pt%
  \hyperlinkslideprev{\beamer@linkspace{7pt}}%
  \hspace{6pt}%
  \hyperlinkslidenext{\beamer@linkspace{7pt}}%
}

%title slide layout
\setbeamerfont{title}{size=\Large,series=\bfseries}
\setbeamerfont{subtitle}{size=\large,series=\mdseries}
\setcounter{framenumber}{-1}
\def\logosep{\hspace{0.044444\paperheight}} % \logosep to be used as separator between partner logos
\def\@partnerlogo{}
\def\partnerlogo{\@ifstar\@partnerlogostar\@partnerlogonostar}%
\def\@partnerlogostar#1{%
  \g@addto@macro\@partnerlogo{\raisebox{\depth}{#1}\logosep\hfill}%
}%
\def\@partnerlogonostar#1{%
  \g@addto@macro\@partnerlogo{\raisebox{\depth}{#1}\logosep}%
}%

\setbeamertemplate{title page}{%
  \begin{tikzpicture}[remember picture,overlay]
  %background
  \fill[color=hzdr-blue] (current page.south west) rectangle (current page.north east);
  %title text
  \node [anchor=north,inner sep=0pt,text width=\paperwidth-0.106666\paperheight] at (current page.north)
  {%
    \ifdefined\titleflushleft\begin{flushleft}\else\begin{centering}\fi%
    \vbox to \paperheight {%
    \vss%
    \vss%
    \color{white}%
    {\usebeamerfont{title}\inserttitle\par}%
    \ifx\insertsubtitle\@empty%
    \else%
      \vskip0.25em%
      {\usebeamerfont{subtitle}\insertsubtitle\par}%
    \fi%
    \vskip1em\par
    {\usebeamerfont{author}\insertauthor\par}%
    \vskip0.5em\par
    {\usebeamerfont{institute}\itshape\insertinstitute\par}
    \vskip1em\par%
    {\usebeamerfont{date}\insertdate\par}%
    \vss%
    \vss%
    \vss%
    }%
    \ifdefined\titleflushleft\end{flushleft}\else\end{centering}\fi%
  };
  \end{tikzpicture}%
}

%head and footlines
\setbeamertemplate{headline}{}% put everything in the footline definition

\setbeamertemplate{footline}{%
  \begin{tikzpicture}[remember picture,overlay]
  %upper left orange spot
  \fill[color=hzdr-orange] (current page.north west) rectangle ++($0.042*(\paperheight,-\paperheight)$);
  %wall clock, navigation symbols at top right
  \node [anchor=north east,inner sep=0pt] at (current page.north east)
  {%
    \color{\beamernavigationcolorlight}%
    \ifdefined\noclock\else{\initclock\raisebox{-0.5\height}{\tiny{\tdyear-\tdmonth-\tdday\quad\tdhours:\tdminutes\space}}}\fi%
    \ifdefined\nonavigation\else{\raisebox{-0.5\height}{\insertfullscreensymbol\insertframenavigationsymbol}}\fi%
  };
  %stripes at the bottom
  \ifnum\c@framenumber>\z@%
    \fill[color=hzdr-blue] (current page.south west) rectangle ++($1/3*(\paperwidth,0)+0.0184*(0,\paperheight)$);
    \fill[color=white] ($(current page.south west)+1/3*(\paperwidth,0)$) rectangle ++($2/3*(\paperwidth,0)+0.0184*(0,\paperheight)$);
    \fill[color=hzdr-gray2]  ($(current page.south west)+0.0184*(0,\paperheight)$) rectangle ++($1/3*(\paperwidth,0)+0.0184*(0,\paperheight)$); %
    \fill[color=hzdr-blue] ($(current page.south west)+0.0184*(0,\paperheight)+1/3*(\paperwidth,0)$) rectangle ++($2/3*(\paperwidth,0)+0.0184*(0,\paperheight)$);
  \else%
    \fill[color=hzdr-gray2] (current page.south west) rectangle ++($1/3*(\paperwidth,0)+0.0184*(0,\paperheight)$);
    \fill[color=white] ($(current page.south west)+1/3*(\paperwidth,0)$) rectangle ++($2/3*(\paperwidth,0)+0.0184*(0,\paperheight)$);
    \fill[color=white]  ($(current page.south west)+0.0184*(0,\paperheight)$) rectangle ++($1/3*(\paperwidth,0)+0.0184*(0,\paperheight)$); %
    \fill[color=hzdr-gray3] ($(current page.south west)+0.0184*(0,\paperheight)+1/3*(\paperwidth,0)$) rectangle ++($1/3*(\paperwidth,0)+0.0184*(0,\paperheight)$);
    \fill[color=hzdr-orange] ($(current page.south west)+0.0368*(0,\paperheight)$) rectangle ++($1/3*(\paperwidth,0)+0.0184*(0,\paperheight)$); %
  \fi%
  %tiny text labels at bottom
  \node [anchor=east,inner sep=0pt] at ($(current page.south east)+0.0092*(0,\paperheight)-0.053333*(\paperheight,0)$)
  {\resizebox{!}{0.00920\paperheight}{\insertshortauthor{} $|$ \insertshortinstitute{} $|$ http//www.hzdr.de}};
  \node [anchor=east,inner sep=0pt] at ($(current page.south east)+0.0276*(0,\paperheight)-0.053333*(\paperheight,0)$)
  {\resizebox{!}{0.00920\paperheight}{\color{white}%
    \iflanguage{german}{Mitglied der Helmholtz-Gemeinschaft}{\iflanguage{ngerman}{Mitglied der Helmholtz-Gemeinschaft}{Member of the Helmholtz Association}}}};
  \ifnum\c@framenumber>\z@%
    \node [anchor=west,inner sep=0pt] at ($(current page.south west)+0.0276*(0,\paperheight)+0.053333*(\paperheight,0)$)
    {\resizebox{!}{0.00920\paperheight}{\color{white}%
      \iflanguage{german}{Seite}{\iflanguage{ngerman}{Seite}{Page}} \insertframenumber/\inserttotalframenumber}};
  \fi%
  %logos
  \ifnum\c@framenumber>\z@%
    \node [anchor=south east,inner sep=0pt] at ($(current page.south east)+0.067*(0,\paperheight)-0.053333*(\paperheight,0)$)
    {\makebox[\paperwidth-0.106666\paperheight][r]{\@partnerlogo\includegraphics[height=0.03\paperheight,hiresbb]{HZDR_MARKE_S_RGB}}};
  \else%
    \node [anchor=north east,inner sep=0pt] at ($(current page.south east)+0.263*(0,\paperheight)-0.053333*(\paperheight,0)$)
    {\makebox[\paperwidth-0.106666\paperheight][r]{\@partnerlogo\includegraphics[height=0.1398949\paperheight,hiresbb]{HZDR_GESAMTLOGO_S_RGB_W}}};
  \fi%
  \end{tikzpicture}%
  \rule{0pt}{0.037\paperheight}%
}

\let\orig@insertcontinuationcountroman\insertcontinuationcountroman
\def\insertcontinuationcountroman{(\orig@insertcontinuationcountroman)}
\defbeamertemplate*{frametitle}{bookmarked} %bookmarks added by default
{%
  \ifdefined\frametitlecentered\centering%
  \else\raggedright\fi%
  \bfseries\Large\insertframetitle\par\mdseries\large\insertframesubtitle\par%
  \only<1>{%
    \bookmark[rellevel=1,keeplevel,page=\thepage]{%
	  \beamer@shortframetitle%
	  \ifnum\beamer@autobreakcount>\z@\space\insertcontinuationcountroman\fi}%
  }%
}
\defbeamertemplate{frametitle}{nobookmark}
{%
  \ifdefined\frametitlecentered\centering%
  \else\raggedright\fi%
  \bfseries\Large\insertframetitle\par\mdseries\large\insertframesubtitle\par%
}
\def\noautobookmark{\setbeamertemplate{frametitle}[nobookmark]}
\def\autobookmark{\setbeamertemplate{frametitle}[bookmarked]}

\setbeamertemplate{navigation symbols}{}

\setbeamersize{text margin left=0.053333\paperheight,text margin right=0.053333\paperheight}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% (C) 2011, Alexander Grahn, zoombox macro, Lic: Public Domain
%
% usage: \zoombox[<dotted border width in pix, default: 1>]{<content>}
%
\newsavebox\zbox
\newcounter{zoom}

\newcommand{\zoombox}[2][1]{% [#1] (optional) sets border line width, default: 1 pixel
  \leavevmode%                {#2} box context
  \sbox\zbox{#2}%
  \pdfdest name {zb\thezoom.out} fit
  \pdfdest name {zb\thezoom.in} fitr
    width  \the\wd\zbox\space
    height \the\ht\zbox\space
    depth  \the\dp\zbox\space
  \immediate\pdfannot
    width  \the\wd\zbox\space
    height \the\ht\zbox\space
    depth  \the\dp\zbox\space
  {%
    /Subtype/Link/H/N
    /Border [0 0 #1 [1 2]]
    /A <<
      /S/JavaScript
      /JS (
        if(typeof(zoomed\thezoom)=='undefined'){
          this.gotoNamedDest('zb\thezoom.out');
          var zoomed\thezoom=false;
        }
      )
      /Next <<
        /S/GoTo/D (zb\thezoom.in)
        /Next <<
          /S/JavaScript
          /JS(
            if(zoomed\thezoom){
               this.gotoNamedDest('zb\thezoom.out');
               zoomed\thezoom=false;
            }else{
               zoomed\thezoom=true;
            }
          )
        >>
      >>
    >>
  }%
  \usebox{\zbox}%
  \stepcounter{zoom}%
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% usage: \tooltip[<link colour>]{<link text>}[<tip box colour>]{<tip text>}
%        \tooltip*[<link colour>]{<link text>}[<tip box colour>]{<tip text>}
%        (starred variant is not draggable)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{media9}[2013/09/24]
\usepackage{xcolor}
\usepackage{calc}
\usepackage{tikzpagenodes}
\usetikzlibrary{calc}
\newlength{\whatsleft}
\newlength{\tipshift}

\ExplSyntaxOn
\let\tpPdfLink\mix_pdflink:nn\let\tpPdfAnnot\mix_pdfannot:nnnn
\let\tpPdfXform\mix_pdfxform:n\def\tpPdfLastXform{\g_mix_pdflastxform_tl}
\mix_insert_acroform:
\ExplSyntaxOff

\NewDocumentCommand{\tooltip}{sO{blue}mO{yellow!20}m}{{%
  \leavevmode%
  \tpPdfLink{%
    /Subtype/Screen%
    /AA<<%
      /E<</S/JavaScript/JS(%
        var fd=this.getField('tip.\thetcnt');%
        \IfBooleanTF{#1}{fd.display=display.visible;}{%
          if(typeof(click\thetcnt)=='undefined'){%
            var click\thetcnt=false;%
            var fdor\thetcnt=fd.rect;var dragging\thetcnt=false;%
          }%
          if(fd.display==display.hidden){%
            fd.delay=true;fd.display=display.visible;fd.delay=false;%
          }%
        }%
        this.dirty=false;%
      )>>%
      /X<</S/JavaScript/JS(%
      \IfBooleanTF{#1}{fd.display=display.hidden;}{%
        if(!click\thetcnt&&!dragging\thetcnt){fd.display=display.hidden;}%
        if(!dragging\thetcnt){click\thetcnt=false;}this.dirty=false;%
      }%
      )>>%
      \IfBooleanF{#1}{%
        /U<</S/JavaScript/JS(click\thetcnt=true;this.dirty=false;)>>%
        /PC<</S/JavaScript/JS (%
          var fd=this.getField('tip.\thetcnt');%
          try{fd.rect=fdor\thetcnt;}catch(e){}%
          fd.display=display.hidden;this.dirty=false;%
        )>>%
      }%
    >>%
  }{{\color{#2}#3}}%
  \sbox\tiptext{\fcolorbox{black}{#4}{#5}}%
  \edef\twd{\the\wd\tiptext}%
  \edef\tht{\the\ht\tiptext}%
  \edef\tdp{\the\dp\tiptext}%
  \measureremainder{\whatsleft}%
  \tipshift=0pt%
  \ifdim\whatsleft<\twd\setlength\tipshift{\whatsleft-\twd}\fi%
  \hspace{\tipshift}\tpPdfXform{\tiptext}%
  \raisebox{\heightof{#3}}[0pt][0pt]{\makebox[0pt][l]{%
    \tpPdfAnnot{\twd}{\tht}{\tdp}{%
      /Subtype/Widget/FT/Btn/Ff 65536/T (tip.\thetcnt)/F 3%
      /MK<</TP 1/I \tpPdfLastXform/IF<</S/A/FB true/A [0.0 0.0]>>>>%
      \IfBooleanF{#1}{%
        /AA <<%
          /U <<%
            /S/JavaScript/JS(%
              var fd=event.target;%
              var mX=this.mouseX;var mY=this.mouseY;%
              var drag=function(){%
                var nX=this.mouseX;var nY=this.mouseY;%
                var dX=nX-mX;var dY=nY-mY;%
                var fdr=fd.rect;%
                fdr[0]+=dX;fdr[1]+=dY;fdr[2]+=dX;fdr[3]+=dY;%
                fd.rect=fdr;mX=nX;mY=nY;%
              };%
              if(!dragging\thetcnt){%
                dragging\thetcnt=true;Int=app.setInterval("drag()",1);%
              }%
              else{app.clearInterval(Int);dragging\thetcnt=false;}%
              this.dirty=false;%
            )%
          >>%
        >>%
      }%
    }%
  }}%
  \stepcounter{tcnt}%
}}
\newsavebox\tiptext\newcounter{tcnt}
\newcommand{\measureremainder}[1]{%
  \begin{tikzpicture}[overlay,remember picture]
    \path let \p0 = (0,0), \p1 = (current page text area.east) in
      [/utils/exec={\pgfmathsetlength#1{\x1-\x0}\global#1=#1}];
  \end{tikzpicture}%
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
