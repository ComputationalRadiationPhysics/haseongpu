\section{Application}
\numberwithin{equation}{section}
\label{sec:application}

The application is available as a commandline-tool and reads
its simulation data from plain text files. It was improved by polychromatic
wavelengths, adaptive sampling, repetetive sampling, multigpu computation and 
reflections as to the orginal application from D. Albach \cite{ASE2010}.

For an easy access, the offered MATLAB compatible interface (see \ref{label:matlab_interface}) 
is highly recommended. Experienced users with the intention to call the application
directly should consult the README file, the provided 
example code or the source code for more details.

\subsection{Installation and Usage}
The application was tested and developed under a linux environment
and runs on Nvidia graphics cards with compute capability 2.0 (fermi generation) or higher.
It can be built by running make inside the application directory, provided
that make (tested with 3.82), gcc (up to 4.6.2) and cuda (5.0) are installed. 
This will also setup a MATLAB file calcPhiASE.m in the application
directory. 

To run the application from MATLAB, two steps are
necessary in advance:
\begin{enumerate}
  \label{label:matlab_interface}
  \item Include calcPhiASE.m from the application directory into your MATLAB path
  \item Call calcPhiASE function from the MATLAB script: \[[phiASE,~MSE,~nRays] = calcPhiASE(args)\]
\end{enumerate}

\subsubsection{Input Arguments}
\begin{description}
  \label{label:input}
  \item[Mesh information]\mbox{}
    \begin{itemize}
      \setlength{\itemindent}{-2.5em}
    \item Structure (points, triangles, prisms)
    \item Thickness of a mesh slice 
    \item Number of planes
    \item Refractive index of mesh and volume around
    \item Reflectivities of mesh planes bottom and top
    \end{itemize}

  \item[Properties]
    \mbox{}
    \begin{itemize}
      \setlength{\itemindent}{-2.5em}
      \item Stimuli in sample points and volume/prisms $\beta$
      \item Crystal Fluorescence $\tau_{f}$
      \item Cladding (use of different materials)
      \item Doping of the active gain medium $N_{tot}$
    \end{itemize}

  \item[Laser information]
    \mbox{}
    \begin{itemize}
      \setlength{\itemindent}{-2.5em}
      \item laser absorption $\sigma_a$
      \item laser emission $\sigma_e$
    \end{itemize}

   \item[Algorithm information]
    \mbox{}
    \begin{itemize}
      \setlength{\itemindent}{-2.5em}
       \item Maximal number of rays for adaptive sampling
       \item MSE-threshold for adaptive sampling
       \item Number of repetitions for repetitive sampling
       \item Decide whether to activate reflections
     \end{itemize}
    
 \end{description}
A detailed description about the MATLAB compatible interface
and the required arguments is given in the README file 
and should be consulted.

\subsubsection{Output}
The Simulation returns three variables:
\begin{description}
  \item[phiASE] is a matrix of $\Phi_{ASE}(s_i)$ 
  \item[MSE] is a matrix of reached $MSE(s_i)$
  \item[nRays] is a matrix of used rays for the Monte Carlo experiment for each sample point
    
\end{description}
The returned variables are represented as two-dimensional matrices in 
which columns are slice indices and rows are point indices.
For example, the variables for the used gain
medium have 321 rows and 10 columns, what multiplies to
3210 sample points. The value for the $i$th point and
the $j$th slice can then be obtained by Matlab with:
\[value~=~values(i,j)\]
